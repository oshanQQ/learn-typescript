import Head from "next/head";
import { Box } from "@chakra-ui/react";
import fs from "fs";
import { join } from "path";
import { parse } from "csv-parse/sync";
import AudioRecordPanelList from "../components/AudioRecordPanelList";
import { CsvContentUnit } from "../types/CsvContentUnit";

type Props = {
  csvContent: CsvContentUnit[];
};

const Home = ({ csvContent }: Props) => {
  return (
    <Box padding={10}>
      <Head>
        <>
          {() => {
            // CSRでscriptを実行するために行う
            if (!window.MediaRecorder) {
              document.write(
                decodeURI('%3Cscript defer src="/polyfill.js">%3C/script>')
              );
            }
          }}
          <title>Create Next App</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </>
      </Head>
      <AudioRecordPanelList csvContent={csvContent} />
    </Box>
  );
};

export default Home;

export const getStaticProps = async () => {
  const csvFilePath = join(process.cwd(), "phrase.csv");
  const headers = ["phrase"];
  const fileContent = fs.readFileSync(csvFilePath, { encoding: "utf-8" });
  const csvContent: CsvContentUnit[] = parse(fileContent, {
    delimiter: ",",
    columns: headers,
  });

  return {
    props: { csvContent },
  };
};
